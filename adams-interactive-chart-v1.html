import React, { useState, useEffect } from 'react';
import { AreaChart, Area, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, ReferenceLine } from 'recharts';
import { Calendar, Clock, Award, Play, Pause, RotateCcw } from 'lucide-react';

const InteractiveTimelineVisualizer = () => {
  const [currentDay, setCurrentDay] = useState(0);
  const [isPlaying, setIsPlaying] = useState(false);
  const [selectedPath, setSelectedPath] = useState('all');

  // Sample data dengan berbagai metrics per hari
  const generateSampleData = () => {
    const data = [];
    for (let day = 0; day <= 720; day += 30) {
      // Standard path data
      const standardPrice = Math.max(0.30, 0.50 + (day / 720) * 0.80 + Math.sin(day / 120) * 0.15);
      const standardTreasury = Math.min(60, 15 + (day / 720) * 25 + Math.random() * 5);
      const standardCommitments = Math.min(40, (day / 720) * 20 + Math.random() * 8);

      // Moderate path data  
      const moderatePrice = Math.max(0.40, 0.75 + (day / 540) * 0.95 + Math.sin(day / 100) * 0.12);
      const moderateTreasury = Math.min(65, 25 + (day / 540) * 30 + Math.random() * 6);
      const moderateCommitments = Math.min(50, (day / 540) * 35 + Math.random() * 10);

      // Accelerated path data
      const acceleratedPrice = Math.max(0.60, 1.00 + (day / 365) * 1.50 + Math.sin(day / 80) * 0.20);
      const acceleratedTreasury = Math.min(70, 35 + (day / 365) * 35 + Math.random() * 8);
      const acceleratedCommitments = Math.min(65, (day / 365) * 50 + Math.random() * 12);

      data.push({
        day,
        standard: {
          price: standardPrice,
          treasury: standardTreasury,
          commitments: standardCommitments,
          progress: Math.min(100, (day / 720) * 100)
        },
        moderate: {
          price: moderatePrice,
          treasury: moderateTreasury,
          commitments: moderateCommitments,
          progress: Math.min(100, (day / 540) * 100)
        },
        accelerated: {
          price: acceleratedPrice,
          treasury: acceleratedTreasury,
          commitments: acceleratedCommitments,
          progress: Math.min(100, (day / 365) * 100)
        }
      });
    }
    return data;
  };

  const sampleData = generateSampleData();

  // Auto-play functionality
  useEffect(() => {
    let interval;
    if (isPlaying) {
      interval = setInterval(() => {
        setCurrentDay(prev => {
          if (prev >= 720) {
            setIsPlaying(false);
            return 720;
          }
          return prev + 15;
        });
      }, 200);
    }
    return () => clearInterval(interval);
  }, [isPlaying]);

  // Get current data point
  const getCurrentDataPoint = () => {
    return sampleData.find(d => d.day <= currentDay) || sampleData[0];
  };

  const currentData = getCurrentDataPoint();

  // Timeline milestones
  const milestones = [
    { day: 0, label: 'Start', milestone: 0 },
    { day: 120, label: 'M1', milestone: 1 },
    { day: 240, label: 'M2', milestone: 2 },
    { day: 360, label: 'M3', milestone: 3 },
    { day: 480, label: 'M4', milestone: 4 },
    { day: 600, label: 'M5', milestone: 5 },
    { day: 720, label: 'M6', milestone: 6 }
  ];

  // Path completion times
  const pathCompletionDays = {
    standard: 720,
    moderate: 540,
    accelerated: 365
  };

  // Check which milestones are completed for each path
  const getMilestoneStatus = (pathKey) => {
    const completionDay = pathCompletionDays[pathKey];
    const progressRatio = currentDay / completionDay;
    return Math.min(6, Math.floor(progressRatio * 6));
  };

  // Format currency
  const formatCurrency = (value) => {
    return new Intl.NumberFormat('en-US', {
      style: 'currency',
      currency: 'USD',
      minimumFractionDigits: 2,
      maximumFractionDigits: 2
    }).format(value);
  };

  // Chart data for current state
  const getChartData = () => {
    return sampleData.filter(d => d.day <= currentDay).map(d => ({
      day: d.day,
      'Standard Price': d.standard.price,
      'Moderate Price': d.moderate.price,
      'Accelerated Price': d.accelerated.price
    }));
  };

  const pathColors = {
    standard: '#00528a',
    moderate: '#20b2aa',
    accelerated: '#b15bcf'
  };

  return (
    <div style={{
      fontFamily: "'Montserrat', sans-serif",
      width: '100%',
      backgroundColor: 'white',
      padding: '20px',
      minHeight: '100vh',
      color: '#333'
    }}>
      {/* Header */}
      <h1 style={{
        fontSize: '20px',
        fontWeight: '600',
        color: '#262626',
        margin: '0 0 8px 0',
        lineHeight: '1.3',
        textAlign: 'left'
      }}>
        Interactive ADAMS Timeline Progression
      </h1>
      
      <p style={{
        fontSize: '14px',
        fontWeight: '400',
        color: '#666666',
        margin: '0 0 24px 0',
        lineHeight: '1.4',
        textAlign: 'left',
        maxWidth: '600px'
      }}>
        Slide through time to see how different acceleration paths perform over the distribution period
      </p>

      {/* Controls */}
      <div style={{
        display: 'flex',
        gap: '12px',
        marginBottom: '24px',
        flexWrap: 'wrap',
        alignItems: 'center'
      }}>
        <button
          onClick={() => setIsPlaying(!isPlaying)}
          style={{
            padding: '8px 16px',
            borderRadius: '4px',
            fontFamily: "'Montserrat', sans-serif",
            fontWeight: '500',
            fontSize: '13px',
            cursor: 'pointer',
            border: '1px solid #00528a',
            backgroundColor: isPlaying ? '#00528a' : 'white',
            color: isPlaying ? 'white' : '#00528a',
            display: 'flex',
            alignItems: 'center',
            gap: '6px'
          }}
        >
          {isPlaying ? <Pause size={14} /> : <Play size={14} />}
          {isPlaying ? 'Pause' : 'Play'}
        </button>
        
        <button
          onClick={() => {
            setCurrentDay(0);
            setIsPlaying(false);
          }}
          style={{
            padding: '8px 16px',
            borderRadius: '4px',
            fontFamily: "'Montserrat', sans-serif",
            fontWeight: '500',
            fontSize: '13px',
            cursor: 'pointer',
            border: '1px solid #666',
            backgroundColor: 'white',
            color: '#666',
            display: 'flex',
            alignItems: 'center',
            gap: '6px'
          }}
        >
          <RotateCcw size={14} />
          Reset
        </button>

        <div style={{
          display: 'flex',
          gap: '8px',
          marginLeft: '16px'
        }}>
          {['all', 'standard', 'moderate', 'accelerated'].map(path => (
            <button
              key={path}
              onClick={() => setSelectedPath(path)}
              style={{
                padding: '6px 12px',
                borderRadius: '4px',
                fontFamily: "'Montserrat', sans-serif",
                fontWeight: '500',
                fontSize: '12px',
                cursor: 'pointer',
                border: `1px solid ${selectedPath === path ? '#00528a' : '#d0d0d0'}`,
                backgroundColor: selectedPath === path ? '#00528a' : '#f8f8f8',
                color: selectedPath === path ? 'white' : '#333'
              }}
            >
              {path.charAt(0).toUpperCase() + path.slice(1)}
            </button>
          ))}
        </div>
      </div>

      {/* Time Slider */}
      <div style={{
        marginBottom: '24px',
        padding: '16px',
        border: '1px solid #e0e0e0',
        borderRadius: '4px',
        backgroundColor: '#fafafa'
      }}>
        <div style={{
          display: 'flex',
          justifyContent: 'space-between',
          alignItems: 'center',
          marginBottom: '12px'
        }}>
          <div style={{
            fontSize: '16px',
            fontWeight: '600',
            color: '#262626'
          }}>
            Day {currentDay} / 720
          </div>
          <div style={{
            fontSize: '14px',
            color: '#666'
          }}>
            {Math.round((currentDay / 30))} months elapsed
          </div>
        </div>
        
        <input
          type="range"
          min="0"
          max="720"
          step="15"
          value={currentDay}
          onChange={(e) => {
            setCurrentDay(parseInt(e.target.value));
            setIsPlaying(false);
          }}
          style={{
            width: '100%',
            height: '8px',
            borderRadius: '4px',
            background: `linear-gradient(to right, #00528a 0%, #00528a ${(currentDay/720)*100}%, #e0e0e0 ${(currentDay/720)*100}%, #e0e0e0 100%)`,
            outline: 'none',
            cursor: 'pointer'
          }}
        />

        {/* Timeline markers */}
        <div style={{
          display: 'flex',
          justifyContent: 'space-between',
          marginTop: '8px',
          position: 'relative'
        }}>
          {milestones.map((milestone, index) => (
            <div
              key={index}
              style={{
                display: 'flex',
                flexDirection: 'column',
                alignItems: 'center',
                fontSize: '11px',
                color: currentDay >= milestone.day ? '#00528a' : '#999'
              }}
            >
              <div style={{
                width: '8px',
                height: '8px',
                borderRadius: '50%',
                backgroundColor: currentDay >= milestone.day ? '#00528a' : '#ddd',
                marginBottom: '4px'
              }}></div>
              <span>{milestone.label}</span>
            </div>
          ))}
        </div>
      </div>

      {/* Current Metrics Dashboard */}
      <div style={{
        display: 'grid',
        gridTemplateColumns: 'repeat(auto-fit, minmax(280px, 1fr))',
        gap: '16px',
        marginBottom: '24px'
      }}>
        {Object.entries(pathColors).map(([pathKey, color]) => {
          if (selectedPath !== 'all' && selectedPath !== pathKey) return null;
          
          const data = currentData[pathKey];
          const completedMilestones = getMilestoneStatus(pathKey);
          const isCompleted = currentDay >= pathCompletionDays[pathKey];
          
          return (
            <div
              key={pathKey}
              style={{
                backgroundColor: 'white',
                padding: '16px',
                borderRadius: '4px',
                border: '1px solid #e0e0e0',
                borderLeft: `4px solid ${color}`,
                opacity: isCompleted && currentDay > pathCompletionDays[pathKey] ? 0.7 : 1
              }}
            >
              <div style={{
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'space-between',
                marginBottom: '12px'
              }}>
                <h3 style={{
                  fontSize: '16px',
                  fontWeight: '600',
                  color: '#262626',
                  margin: 0,
                  textTransform: 'capitalize'
                }}>
                  {pathKey} Path
                </h3>
                {isCompleted && (
                  <span style={{
                    fontSize: '12px',
                    color: color,
                    fontWeight: '600',
                    backgroundColor: `${color}20`,
                    padding: '2px 8px',
                    borderRadius: '12px'
                  }}>
                    COMPLETED
                  </span>
                )}
              </div>

              <div style={{
                display: 'grid',
                gridTemplateColumns: '1fr 1fr',
                gap: '8px',
                marginBottom: '12px'
              }}>
                <div style={{
                  backgroundColor: '#f8f8f8',
                  padding: '8px',
                  borderRadius: '4px'
                }}>
                  <div style={{
                    fontSize: '11px',
                    color: '#666',
                    marginBottom: '2px'
                  }}>Current Price</div>
                  <div style={{
                    fontSize: '14px',
                    fontWeight: '600',
                    color: color
                  }}>{formatCurrency(data.price)}</div>
                </div>

                <div style={{
                  backgroundColor: '#f8f8f8',
                  padding: '8px',
                  borderRadius: '4px'
                }}>
                  <div style={{
                    fontSize: '11px',
                    color: '#666',
                    marginBottom: '2px'
                  }}>Treasury</div>
                  <div style={{
                    fontSize: '14px',
                    fontWeight: '600',
                    color: color
                  }}>{data.treasury.toFixed(1)}%</div>
                </div>

                <div style={{
                  backgroundColor: '#f8f8f8',
                  padding: '8px',
                  borderRadius: '4px'
                }}>
                  <div style={{
                    fontSize: '11px',
                    color: '#666',
                    marginBottom: '2px'
                  }}>Commitments</div>
                  <div style={{
                    fontSize: '14px',
                    fontWeight: '600',
                    color: color
                  }}>{data.commitments.toFixed(1)}%</div>
                </div>

                <div style={{
                  backgroundColor: '#f8f8f8',
                  padding: '8px',
                  borderRadius: '4px'
                }}>
                  <div style={{
                    fontSize: '11px',
                    color: '#666',
                    marginBottom: '2px'
                  }}>Milestones</div>
                  <div style={{
                    fontSize: '14px',
                    fontWeight: '600',
                    color: color
                  }}>{completedMilestones}/6</div>
                </div>
              </div>

              {/* Progress Bar */}
              <div style={{
                backgroundColor: '#e0e0e0',
                height: '6px',
                borderRadius: '3px',
                overflow: 'hidden'
              }}>
                <div style={{
                  backgroundColor: color,
                  height: '100%',
                  width: `${Math.min(100, (currentDay / pathCompletionDays[pathKey]) * 100)}%`,
                  transition: 'width 0.3s ease'
                }}></div>
              </div>
              <div style={{
                fontSize: '11px',
                color: '#666',
                marginTop: '4px',
                textAlign: 'center'
              }}>
                {Math.min(100, Math.round((currentDay / pathCompletionDays[pathKey]) * 100))}% Complete
              </div>
            </div>
          );
        })}
      </div>

      {/* Price Chart */}
      <div style={{
        marginBottom: '16px',
        border: '1px solid #e0e0e0',
        background: 'white',
        padding: '16px'
      }}>
        <h3 style={{
          fontSize: '16px',
          fontWeight: '600',
          color: '#262626',
          marginBottom: '16px'
        }}>Price Evolution Over Time</h3>
        
        <ResponsiveContainer width="100%" height={300}>
          <AreaChart data={getChartData()}>
            <CartesianGrid strokeDasharray="3 3" stroke="#e0e0e0" />
            <XAxis 
              dataKey="day"
              tick={{
                fontFamily: "'Montserrat', sans-serif",
                fontSize: 12,
                fill: '#666'
              }}
              label={{ 
                value: 'Days', 
                position: 'insideBottom', 
                offset: -10,
                style: { textAnchor: 'middle', fontFamily: "'Montserrat', sans-serif" }
              }}
            />
            <YAxis 
              tick={{
                fontFamily: "'Montserrat', sans-serif",
                fontSize: 12,
                fill: '#666'
              }}
              tickFormatter={(value) => formatCurrency(value)}
              label={{ 
                value: 'Token Price', 
                angle: -90, 
                position: 'insideLeft',
                style: { textAnchor: 'middle', fontFamily: "'Montserrat', sans-serif" }
              }}
            />
            <Tooltip 
              formatter={(value, name) => [formatCurrency(value), name]}
              labelFormatter={(day) => `Day ${day}`}
              contentStyle={{
                backgroundColor: 'white',
                border: '1px solid #e0e0e0',
                borderRadius: '4px',
                fontFamily: "'Montserrat', sans-serif"
              }}
            />
            <Legend />
            
            {(selectedPath === 'all' || selectedPath === 'standard') && (
              <Area
                type="monotone"
                dataKey="Standard Price"
                stroke={pathColors.standard}
                fill={pathColors.standard}
                fillOpacity={0.3}
                strokeWidth={2}
              />
            )}
            
            {(selectedPath === 'all' || selectedPath === 'moderate') && (
              <Area
                type="monotone"
                dataKey="Moderate Price"
                stroke={pathColors.moderate}
                fill={pathColors.moderate}
                fillOpacity={0.3}
                strokeWidth={2}
              />
            )}
            
            {(selectedPath === 'all' || selectedPath === 'accelerated') && (
              <Area
                type="monotone"
                dataKey="Accelerated Price"
                stroke={pathColors.accelerated}
                fill={pathColors.accelerated}
                fillOpacity={0.3}
                strokeWidth={2}
              />
            )}
            
            <ReferenceLine x={currentDay} stroke="#ff6b6b" strokeDasharray="5 5" />
          </AreaChart>
        </ResponsiveContainer>
      </div>

      {/* Source */}
      <div style={{
        fontSize: '11px',
        fontWeight: '400',
        color: '#888',
        marginTop: '16px',
        lineHeight: '1.3',
        textAlign: 'left'
      }}>
        Source: Interactive simulation of ADAMS token distribution with sample performance data
      </div>
    </div>
  );
};

export default InteractiveTimelineVisualizer;